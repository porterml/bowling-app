{% extends "base.html" %} {% block title %}All Games - Bowling Analytics{%
endblock %} {% block content %}
<div class="row mb-4">
	<div class="col-12">
		<div class="d-flex justify-content-between align-items-center">
			<h1 class="display-5"><i class="fas fa-list me-3"></i>All Games</h1>
			<a href="{{ url_for('add_game') }}" class="btn btn-primary">
				<i class="fas fa-plus me-2"></i>Add New Game
			</a>
		</div>
	</div>
</div>

{% if games %}
<div class="row">
	<div class="col-12">
		<div class="card">
			<div class="card-body">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead>
							<tr>
								<th>Date</th>
								<th>Score</th>
								<th>Strikes</th>
								<th>Spares</th>
								<th>Splits</th>
								<th>Notes</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{% for game in games %}
							<tr>
								<td>{{ game.date.strftime('%m/%d/%Y') }}</td>
								<td>
									<span class="badge bg-primary fs-6"
										>{{ game.total_score }}</span
									>
								</td>
								<td>
									{% set strikes =
									game.frames|selectattr('is_strike')|list|length %}
									<span class="text-warning fw-bold">{{ strikes }}</span>
								</td>
								<td>
									{% set spares = game.frames|selectattr('is_spare')|list|length
									%}
									<span class="text-secondary fw-bold">{{ spares }}</span>
								</td>
								<td>
									{% set splits = game.frames|selectattr('is_split')|list|length
									%}
									<span class="text-danger fw-bold">{{ splits }}</span>
								</td>
								<td>
									{% if game.notes %}
									<span
										class="text-truncate d-inline-block"
										style="max-width: 200px"
										title="{{ game.notes }}"
									>
										{{ game.notes }}
									</span>
									{% else %}
									<span class="text-muted">-</span>
									{% endif %}
								</td>
								<td>
									<div class="btn-group" role="group">
										<a
											href="{{ url_for('game_detail', game_id=game.id) }}"
											class="btn btn-sm btn-outline-primary"
										>
											<i class="fas fa-eye"></i>
										</a>
										<button
											type="button"
											class="btn btn-sm btn-outline-danger"
											onclick="deleteGame({{ game.id }})"
										>
											<i class="fas fa-trash"></i>
										</button>
									</div>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Summary Stats -->
<div class="row mt-4">
	<div class="col-md-4">
		<div class="card bg-light">
			<div class="card-body text-center">
				<h5 class="card-title">Total Games</h5>
				<h3 class="text-primary">{{ games|length }}</h3>
			</div>
		</div>
	</div>
	<div class="col-md-4">
		<div class="card bg-light">
			<div class="card-body text-center">
				<h5 class="card-title">Average Score</h5>
				<h3 class="text-success">
					{% set avg = games|map(attribute='total_score')|sum / games|length %}
					{{ "%.1f"|format(avg) }}
				</h3>
			</div>
		</div>
	</div>
	<div class="col-md-4">
		<div class="card bg-light">
			<div class="card-body text-center">
				<h5 class="card-title">Best Score</h5>
				<h3 class="text-warning">
					{{ games|map(attribute='total_score')|max }}
				</h3>
			</div>
		</div>
	</div>
</div>

{% else %}
<div class="row">
	<div class="col-lg-8 mx-auto">
		<div class="card text-center">
			<div class="card-body py-5">
				<i class="fas fa-bowling-ball fa-4x text-muted mb-4"></i>
				<h3 class="card-title">No Games Yet</h3>
				<p class="card-text text-muted">
					Start tracking your bowling performance by adding your first game!
				</p>
				<a href="{{ url_for('add_game') }}" class="btn btn-primary btn-lg">
					<i class="fas fa-plus me-2"></i>Add Your First Game
				</a>
			</div>
		</div>
	</div>
</div>
{% endif %} {% endblock %} {% block scripts %}
<script>
	function deleteGame(gameId) {
		if (
			confirm(
				"Are you sure you want to delete this game? This action cannot be undone."
			)
		) {
			// Create a form to submit the DELETE request
			const form = document.createElement("form");
			form.method = "POST";
			form.action = '{{ url_for("delete_game", game_id=0) }}'.replace(
				"0",
				gameId
			);

			// Add CSRF token
			const csrfToken = document.querySelector("meta[name=csrf-token]");
			if (csrfToken) {
				const input = document.createElement("input");
				input.type = "hidden";
				input.name = "csrf_token";
				input.value = csrfToken.getAttribute("content");
				form.appendChild(input);
			}

			document.body.appendChild(form);
			form.submit();
		}
	}
</script>
{% endblock %}
